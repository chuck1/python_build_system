src_dir    = {{ src_dir }}
inc_dir    = {{ inc_dir }}
build_dir  = {{ build_dir }}
inc        = {{ inc_str }} 
define_str = {{ define_str }}
binary     = {{ binary_file }}
compiler_dir = {{ compiler_dir }}
master_config_dir = {{ master_config_dir }}
makefile          = {{ makefile }}
project_name      = {{ project_name }}
library_type      = static

depends_dir = $(build_dir)/depends
objects_dir = $(build_dir)/objects

CC = g++

include $(compiler_dir)/color.mk
include $(compiler_dir)/cpp_library.mk


.PHONY: all

all: $(binary)
	@bash -c "echo -e \"$(COLOR_BLUE)$(build_dir)$(COLOR_RESET)\""

s = $(COLOR_BLUE)build$(COLOR_RESET)

CFLAGS = -g -std=c++0x -Wno-format-security -fPIC

CARGS = $(CFLAGS) $(inc) $(define_str)

MAKEDEPEND = $(CC) -c $(CARGS) -MM $< -MF $(depends_dir)/$*.cpp.d -MT $(objects_dir)/$*.cpp.o
GCH = $(CC) -c -x c++-header

include $(compiler_dir)/process.mk

$(pch_files): $(inc_dir)/%.hpp.gch: $(inc_dir)/%.hpp
	@bash -c "echo -e \"$(COLOR_BLUE)pch $@$(COLOR_RESET)\""
	@mkdir -p $(dir $@)
	@$(GCH) $(CARGS) -o $@ $<

$(obj): $(inc_processed) $(pch_files)

$(obj): $(build_dir)/objects/%.cpp.o: $(src_dir)/%.cpp
	@bash -c "echo -e \"$(COLOR_BLUE)build $@$(COLOR_RESET)\""
	@mkdir -p $(dir $@)
	@mkdir -p $(dir $(build_dir)/depends/$*.cpp.d)
	@$(MAKEDEPEND)
	@$(CC) -c $(CARGS) -o $@ $<

$(obj_processed): $(build_dir)/objects/%.cpp.o: $(build_dir)/processed/src/%.cpp
	@bash -c "echo -e \"$(COLOR_BLUE)build $@$(COLOR_RESET)\""
	@mkdir -p $(dir $@)
	@mkdir -p $(dir $(build_dir)/depends/$*.cpp.d)
	@$(MAKEDEPEND)
	@$(CC) -c $(CARGS) -o $@ $<

$(binary): $(makefile)

$(binary): $(obj)
	@bash -c "echo -e \"$(COLOR_BLUE)build $@$(COLOR_RESET)\""
	@mkdir -p $(dir $@)
	@ar rcs $@ $(filter %.cpp.o, $^)

clean:
	@rm -rf $(build_dir)/objects/*
	@rm -rf $(build_dir)/depends/*

include $(compiler_dir)/help.mk

dependclean:
	@rm -rf $(build_dir)/depends/*

$(dep_files): $(depends_dir)/%.cpp.d: $(src_dir)/%.cpp
	@bash -c "echo -e \"$(COLOR_BLUE)build deps $@$(COLOR_RESET)\""
	@mkdir -p $(dir $(depends_dir)/$*.cpp.d)
	@$(MAKEDEPEND)


include $(dep_files)



